{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _this = this,\n    _jsxFileName = \"/home/matheus/Documents/drive-sync/Projects/lafe/packages/web/src/hooks/authentication.tsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { createContext, useCallback, useContext, useEffect } from 'react';\nimport { useRouter } from 'next/router';\nimport usePersistedState from '@/utils/hooks/usePersistedState';\nimport api from '../services/api';\nimport { jsx as ___EmotionJSX } from \"@emotion/core\";\nvar AuthenticationContext = /*#__PURE__*/createContext({});\n\nvar AuthenticationProvider = function AuthenticationProvider(_ref) {\n  _s();\n\n  var children = _ref.children;\n\n  var _usePersistedState = usePersistedState('session', null),\n      _usePersistedState2 = _slicedToArray(_usePersistedState, 2),\n      data = _usePersistedState2[0],\n      setData = _usePersistedState2[1];\n\n  var router = useRouter();\n  var isLoggedIn = useCallback(function () {\n    return !!(data === null || data === void 0 ? void 0 : data.access_token);\n  }, [data]);\n  var logIn = useCallback( /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(_ref2) {\n      var email, password, response;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              email = _ref2.email, password = _ref2.password;\n              _context.next = 3;\n              return api.post('/sessions', {\n                email: email,\n                password: password\n              });\n\n            case 3:\n              response = _context.sent;\n              setData(response.data);\n\n            case 5:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function (_x) {\n      return _ref3.apply(this, arguments);\n    };\n  }(), [setData]);\n  var logOut = useCallback(function () {\n    setData(null);\n    router.replace('/login');\n  }, [setData]);\n  useEffect(function () {\n    var route = router.asPath;\n\n    var isRoute = function isRoute(name) {\n      return route.split('?')[0] === name;\n    };\n\n    if (!isLoggedIn()) {\n      if (!isRoute('/login')) {\n        router.replace('/login');\n      }\n\n      return;\n    }\n\n    if (isRoute('/') || isRoute('/login') || isRoute('/app')) {\n      router.replace('/dashboard');\n      return;\n    }\n\n    api.get('profile').then(function (response) {\n      setData(_objectSpread(_objectSpread({}, data), {}, {\n        user: response.data\n      }));\n    });\n  }, [router]);\n  return ___EmotionJSX(AuthenticationContext.Provider, {\n    value: {\n      user: data === null || data === void 0 ? void 0 : data.user,\n      isLoggedIn: isLoggedIn,\n      logIn: logIn,\n      logOut: logOut\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 5\n    }\n  }, children);\n};\n\n_s(AuthenticationProvider, \"t0xlUpRq5FKsniYOgFJDo6rGO2E=\", false, function () {\n  return [usePersistedState, useRouter];\n});\n\n_c = AuthenticationProvider;\n\nfunction useAuthentication() {\n  _s2();\n\n  var context = useContext(AuthenticationContext);\n\n  if (!context) {\n    throw new Error(\"'useAuthentication' must be used within an 'AuthenticationProvider'\");\n  }\n\n  return context;\n}\n\n_s2(useAuthentication, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\n\nexport { AuthenticationProvider, useAuthentication };\n\nvar _c;\n\n$RefreshReg$(_c, \"AuthenticationProvider\");","map":{"version":3,"sources":["/home/matheus/Documents/drive-sync/Projects/lafe/packages/web/src/hooks/authentication.tsx"],"names":["React","createContext","useCallback","useContext","useEffect","useRouter","usePersistedState","api","AuthenticationContext","AuthenticationProvider","children","data","setData","router","isLoggedIn","access_token","logIn","email","password","post","response","logOut","replace","route","asPath","isRoute","name","split","get","then","user","useAuthentication","context","Error"],"mappings":"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","sourcesContent":["import React, {\n  createContext,\n  useCallback,\n  useContext,\n  useEffect,\n} from 'react';\n\nimport { useRouter } from 'next/router';\n\nimport usePersistedState from '@/utils/hooks/usePersistedState';\n\nimport api from '../services/api';\n\ninterface IUser {\n  id: string;\n  name: string;\n  email: string;\n  role: string;\n}\n\nexport default interface ISession {\n  user: IUser;\n  access_token: string;\n  refresh_token: string;\n}\n\ntype ICreateSessionResponse = ISession;\n\ninterface ISignInCredentials {\n  email: string;\n  password: string;\n}\n\ninterface IAuthenticationContextData {\n  user?: IUser;\n  isLoggedIn(): boolean;\n  logIn(credentials: ISignInCredentials): Promise<void>;\n  logOut(): void;\n}\n\nconst AuthenticationContext = createContext<IAuthenticationContextData>(\n  {} as IAuthenticationContextData,\n);\n\nconst AuthenticationProvider: React.FC = ({ children }) => {\n  const [data, setData] = usePersistedState<ISession>('session', null);\n\n  const router = useRouter();\n\n  const isLoggedIn = useCallback(() => !!data?.access_token, [data]);\n\n  const logIn = useCallback(\n    async ({ email, password }: ISignInCredentials) => {\n      const response = await api.post<ICreateSessionResponse>('/sessions', {\n        email,\n        password,\n      });\n\n      setData(response.data);\n    },\n    [setData],\n  );\n\n  const logOut = useCallback(() => {\n    setData(null);\n\n    router.replace('/login');\n  }, [setData]);\n\n  useEffect(() => {\n    const route = router.asPath;\n\n    const isRoute = (name: string) => route.split('?')[0] === name;\n\n    if (!isLoggedIn()) {\n      if (!isRoute('/login')) {\n        router.replace('/login');\n      }\n      return;\n    }\n\n    if (isRoute('/') || isRoute('/login') || isRoute('/app')) {\n      router.replace('/dashboard');\n      return;\n    }\n\n    api.get<IUser>('profile').then(response => {\n      setData({\n        ...data,\n        user: response.data,\n      });\n    });\n  }, [router]);\n\n  return (\n    <AuthenticationContext.Provider\n      value={{\n        user: data?.user,\n        isLoggedIn,\n        logIn,\n        logOut,\n      }}\n    >\n      {children}\n    </AuthenticationContext.Provider>\n  );\n};\n\nfunction useAuthentication(): IAuthenticationContextData {\n  const context = useContext(AuthenticationContext);\n\n  if (!context) {\n    throw new Error(\n      \"'useAuthentication' must be used within an 'AuthenticationProvider'\",\n    );\n  }\n\n  return context;\n}\n\nexport { AuthenticationProvider, useAuthentication };\n"]},"metadata":{},"sourceType":"module"}